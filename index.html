<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.2.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" integrity="sha256-AbA177XfpSnFEvgpYu1jMygiLabzPCJCRIBtR5jGc0k=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"www.xinyuanguo.com","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.13.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="Xinyuan&#39;s Blog">
<meta property="og:url" content="http://www.xinyuanguo.com/index.html">
<meta property="og:site_name" content="Xinyuan&#39;s Blog">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="xinyuan">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://www.xinyuanguo.com/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Xinyuan's Blog</title>
  






  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Xinyuan's Blog</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>







</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">xinyuan</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">6</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
  </nav>
</div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.xinyuanguo.com/2022/03/02/ms4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="xinyuan">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xinyuan's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Xinyuan's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/03/02/ms4/" class="post-title-link" itemprop="url">回顾《Microservices》系列之四：智能终端与哑管道到底解决了什么问题</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-03-02 16:53:00" itemprop="dateCreated datePublished" datetime="2022-03-02T16:53:00+08:00">2022-03-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-09-07 15:22:59" itemprop="dateModified" datetime="2022-09-07T15:22:59+08:00">2022-09-07</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p>本文是笔者作为企业架构咨询顾问，以《Microservices》文章作为主轴，在不同客户企业经历各式各样服务化项目后的所感所想</p>
</blockquote>
<p>本章节原标题“Smart endpoints and dumb pipes”（注意到这里的”智能“是Smart而非AI中的“Intelligence”）</p>
<p>文章首先举例企业消息总线（ESB），这种产品往往包含了<strong>复杂的消息路由、业务规则、模型转换</strong>。目前很多企业采用了这种模式帮助系统集成。</p>
<p>之后提到了微服务推荐的两种集成模式：</p>
<ul>
<li>HTTP</li>
<li>轻量级消息</li>
</ul>
<p>两者相似点就是简单、轻量，专注作为技术底座而不负责业务逻辑。</p>
<p>然而在笔者遇到的企业应用中，不少架构设计和现状仍然背道而驰，似乎并没有意识到这些原则解决的问题：</p>
<h4 id="丢失的软件工程收益"><a href="#丢失的软件工程收益" class="headerlink" title="丢失的软件工程收益"></a>丢失的软件工程收益</h4><p>业务逻辑在服务中实现，往往伴随着完整的测试与验证流程、安全扫描、版本控制，这些往往是产品化软件（如ESB、低代码平台）等无法保证的</p>
<h4 id="业务变化的频次与复杂度"><a href="#业务变化的频次与复杂度" class="headerlink" title="业务变化的频次与复杂度"></a>业务变化的频次与复杂度</h4><p>软件往往解决的是已知问题，例如财务软件、ERP等，他们的输入与产出物格式和在行业中相对固定</p>
<p>而业务的复杂度往往是新的设计、新的玩法，带来的是未知，需要需求分析、实验、快速验证等手段帮助实现。</p>
<p>在此过程中，成品软件往往无法解决此类问题，也无法很好的适应业务变更节奏，作为企业不会买一个ERP的团队天天帮你改代码逻辑</p>
<h4 id="数据管道与业务逻辑耦合"><a href="#数据管道与业务逻辑耦合" class="headerlink" title="数据管道与业务逻辑耦合"></a>数据管道与业务逻辑耦合</h4><p>”领域驱动设计“作为业界服务化设计的重要理论，始终都在弱化”数据“而在强化”模型“的重要性，我们更推荐通过清晰的接口来帮助系统集成，而不是各个系统的数据库通过ETL这种形式数据与数据对话。</p>
<p>因此展开来讲，这里的“哑管道”完全可以替代为“<strong>哑中间件</strong>”，实践也证明了我们不应该把业务逻辑、模型构筑关系放在中间件里边，比如“存储过程”和“视图”</p>
<p>中间件能力的抽象与实现的解耦帮助我们在中间件选择上有更高的自由度，可以用更低的成本更换中间件或供应商，避免核心业务与特定中间件或供应商绑定</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.xinyuanguo.com/2022/01/20/ms3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="xinyuan">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xinyuan's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Xinyuan's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/01/20/ms3/" class="post-title-link" itemprop="url">回顾《Microservices》系列之三：微服务是“产品”而非“项目”</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-01-20 16:57:00" itemprop="dateCreated datePublished" datetime="2022-01-20T16:57:00+08:00">2022-01-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-09-07 15:27:48" itemprop="dateModified" datetime="2022-09-07T15:27:48+08:00">2022-09-07</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p>本文是笔者作为企业架构咨询顾问，以《Microservices》文章作为主轴，在不同客户企业经历各式各样服务化项目后的所感所想</p>
</blockquote>
<p>本章节原标题为：“Products not Projects”</p>
<p>原文主要描述了“项目制”与微服务支持者主张的“产品制”，其中主要区别这里整理了一个对比表：</p>
<p><img src="https://oscimg.oschina.net/oscnet/up-a449c2c727deb7d35b3c90a05f3bc4e60fa.png"></p>
<p>结合在企业中看到的情况，补充以下两点：</p>
<ol>
<li><p>项目制与产品质很可能是不同管理维度共同存在<br>比如在企业做预算、规划等工作事项时，侧重的是成本估算、资源协调、可行性评估等工作，这时往往是项目制可以解决基本诉求。而后续实施落地时如果涉及多个微服务，那么各个微服务可以按照自己产品化的思维给与反馈（排期、意见等）</p>
</li>
<li><p>更好的技术支持<br>文中多次提到让“developers”与“users”之间建立更好的沟通关系，而这在项目制或者大组织下的应用条件下是更难做到的。我们希望颗粒度更小的微服务可以更快的定位到支持人员，并且支持者是开发人员而非单纯的运维人员，以此提高响应速度及解决问题的效率</p>
</li>
</ol>
<p>《Microservices》原文：<br><a target="_blank" rel="noopener" href="https://martinfowler.com/articles/microservices.html">https://martinfowler.com/articles/microservices.html</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.xinyuanguo.com/2021/11/24/enterprise-retail/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="xinyuan">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xinyuan's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Xinyuan's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/11/24/enterprise-retail/" class="post-title-link" itemprop="url">大型零售企业数字化转型的矛盾与挑战</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-11-24 10:13:00" itemprop="dateCreated datePublished" datetime="2021-11-24T10:13:00+08:00">2021-11-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-09-07 15:34:49" itemprop="dateModified" datetime="2022-09-07T15:34:49+08:00">2022-09-07</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="故事背景"><a href="#故事背景" class="headerlink" title="故事背景"></a>故事背景</h3><p>A和B是两家大型跨国企业，高度重视用户体验，业务主要通过自有门店零售，均在其细分领域有很大影响力。</p>
<p>近些年两家企业在中国均开始大力发展电商、O2O等数字化转型。在此期间，企业通常会把保障线下业务的正常运作成为了一个基本要求：即要保证门店在断网的环境下的业务运转。这种模式和渠道电商模式（天猫、京东）类似：即要有脱离企业侧数字化系统的<strong>独立运营能力。</strong></p>
<p><img src="https://oscimg.oschina.net/oscnet/up-5fcb0e36888faf859e29b34fc85684aaf64.png"></p>
<p>这种能力要求也带来了矛盾与挑战，在这儿抱砖引玉提两个：</p>
<h3 id="矛盾1：库存分配与共享的矛盾"><a href="#矛盾1：库存分配与共享的矛盾" class="headerlink" title="矛盾1：库存分配与共享的矛盾"></a>矛盾1：库存分配与共享的矛盾</h3><p>这两家企业的商品都有各自特点</p>
<ul>
<li>A企业包含大量大体积商品：仓储及调拨成本高、库存数量少</li>
<li>B企业包含大量食物及原料：仓储温度、湿度要求高、受食品保质期限制</li>
</ul>
<p>作为企业，往往希望拥有更高的销售效率，跨渠道、门店共享库存，以便让库存流转更加高效</p>
<p><img src="https://oscimg.oschina.net/oscnet/up-ed1fa03243c0cd47843fdabba410e67c32f.png"></p>
<p>而这种跨渠道共享库存设计对系统集成有非常高数据时效性要求，同时又形成了对库存系统的依赖，无法满足独立运营能力的要求。</p>
<h3 id="矛盾2：业务边界与组织边界的矛盾"><a href="#矛盾2：业务边界与组织边界的矛盾" class="headerlink" title="矛盾2：业务边界与组织边界的矛盾"></a>矛盾2：业务边界与组织边界的矛盾</h3><p>领域驱动设计告诉我们要明确业务边界，康威定律告诉我们组织架构映射了系统架构，那么如果一个业务模型存在于不同渠道或组织该怎么办呢？</p>
<p>通常情况下，我们将企业的产品在三方渠道售卖时，我们要提供商品数据，然后三方渠道将交易和订单同步给企业即可。这种模式可行主要因为数据时效性要求不高：商品不会频繁更新，三方渠道与企业不必实时结算。</p>
<p><img src="https://oscimg.oschina.net/oscnet/up-ab8c55a249d90c908f442d732ffda21ed34.png"></p>
<p>但如果加上销售策略，事情就复杂了起来，不论是优惠券、优惠活动还是用户积分，均对数据时效性有了较高要求，同样无法满足独立运营要求</p>
<h3 id="如何应对"><a href="#如何应对" class="headerlink" title="如何应对"></a>如何应对</h3><p>作为企业架构咨询师，我们日常工作就是帮助客户分析问题和给出解决方案。针对以上两个问题，列举一些经验和建议在这里：</p>
<p>针对矛盾1：保证局部时效性，提高全局资源调配效率</p>
<ul>
<li>首先在门店发货的场景下，备货计划和库存调拨在数字化之前已经长久存在，并不会因为O2O或电商的存在带来质变，更多是影响到备货计划：可能更频繁、更准确。</li>
<li>大仓发货的场景下，不建议寄期望于全渠道库存同步，技术门槛高的同时无法满足独立运营要求。只需要保证渠道以及门店在离线期间的局部库存数据时效性。在此基础之上再考虑全渠道库存更新的问题，此时主要解决的是库存信息上报收集以及渠道库存变更的下发。之后可以考虑进一步的跨渠道库存分配优化和线下门店和仓库的实物调拨。</li>
<li>品牌大促和抢购活动的备货计划准确性难以保证，要解决秒杀超卖这种典型的技术问题也是高风险高成本低收益。我们可以<strong>延长履约周期</strong>或是设置<strong>预热预售，</strong>以此来降低对备货计划的依赖和削弱库存对业务的制约。回想近年来的直播带货和双十一大促等，也是经常能看到类似的处理方式。</li>
</ul>
<p>针对矛盾2：控制渠道与门店系统模型复杂度，简化业务逻辑链路</p>
<ul>
<li>跨渠道的数字化风向中，业务模型的影响范围明显扩大。横跨组织边界的抽象业务模型客观存在，我们能做的是控制其<strong>模型复杂度</strong>：比如推送商品、不推送优惠券；推送门店信息而不推送门店活动。复杂的业务场景及逻辑如果是分散在各地或者用发布、订阅方式实现，那么其成本将会趋于不可控。</li>
<li>尊重<strong>渠道差异性</strong>，灵活使用三方营销工具。在企业或品牌影响力下，渠道往往更加积极合作甚至让利：比如支付平台和银行的垫付型支付优惠。借助三方能力轻量化集成关系，会让渠道拓展更加平滑，以便快速集成、快速验证。</li>
<li>保留渠道、门店的<strong>独立基础业务能力</strong>。包括用户、商品、门店等基本模型和成单、支付、履约等业务模型相关能力。即保留按照商品标价购买的能力。在网络恢复或者定期下发基础模型和上报业务模型数据</li>
<li>营销活动、积分、优惠券等<strong>复杂业务模型</strong>在跨渠道跨组织场景下集成成本非常高，即使是大规模企也要投入相当大的成本。不建议放在第一优先级实施</li>
</ul>
<h3 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h3><p>这几年，在疫情的限制下，很多传统大型零售企业都加快了数字化转型的步伐。站在企业架构的视角，传统零售的数字化转型意味着需要构建新的业务价值流，需要重新设计业务架构，然后基于现有系统设计应用架构，数据架构和技术架构。而为了让企业丰富业务模式多样性的同时减少对跨组织系统的依赖，让企业门店或三方渠道平台拥有独立运营能力，我们总结了两个架构原则：</p>
<ul>
<li><strong>保证局部时效性，提高全局资源调配效率</strong></li>
<li><strong>控制渠道与门店系统模型复杂度，简化业务逻辑链路</strong></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.xinyuanguo.com/2021/11/12/ms2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="xinyuan">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xinyuan's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Xinyuan's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/11/12/ms2/" class="post-title-link" itemprop="url">回顾《Microservices》系列之二：围绕“业务能力”进行组织</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-11-12 16:53:00" itemprop="dateCreated datePublished" datetime="2021-11-12T16:53:00+08:00">2021-11-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-09-07 15:28:56" itemprop="dateModified" datetime="2022-09-07T15:28:56+08:00">2022-09-07</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p>本文是笔者作为企业架构咨询顾问，以《Microservices》文章作为主轴，在不同客户企业经历各式各样服务化项目后的所感所想 </p>
</blockquote>
<blockquote>
<p>…often management focuses on the <strong>technology layer, leading to UI teams, server-side logic teams, and database teams</strong>.</p>
<p>…simple changes can <strong>lead to a cross-team</strong> project taking time and budgetary approval. </p>
<p>…force the <strong>logic into whichever application</strong> they have access to. <strong>Logic everywhere</strong> in other words. </p>
</blockquote>
<p>原文首先表述了传统按技术划分团队（UI、业务逻辑、数据库）的两个结果：</p>
<ul>
<li>跨团队协作带来的审批和时间投入</li>
<li>把逻辑做进离组织更近的系统应用中</li>
</ul>
<p>其中第二个结果是为了避免第一个结果的选择，但这很可能是默默埋下的技术债</p>
<p>现实工作中，往往更接近用户一侧的团队面对更多的需求细节和变更，比如UI团队，而按照上述第二种选择的思路就会引起大量业务逻辑停留在前端界面中。这明显是会对后续维护和迭代造成负面影响</p>
<hr>
<blockquote>
<p>The microservice approach to division is different, splitting up into services <strong>organized around business capability</strong>.</p>
<p>…the teams are cross-functional, including  user-experience, database, and project management.</p>
</blockquote>
<p> 第二段文字提到微服务的处理方式是按照业务能力划分团队，并且是包含了用户界面、数据库、系统集成和项目管理的跨功能团队。</p>
<p>在这其中，数据库与微服务团队的自治关系在不少实践中已经逐渐清晰与完善。系统集成在自动化API文档、自动化测试脚本等工具也逐渐成熟</p>
<p>但在我看到的团队里，用户界面和项目管理这两点还很难做到“跨功能团队”级别的效果，其中：</p>
<ul>
<li>关于用户体验层面，微前端一定程度上可以帮忙解决部分问题。但同时，对于用户体验层面，业务常常无法划清界限，且很可能有依赖关系。在我看来，即使是团队由非常有经验的工程师组成，要解决这个问题还是有很多探索性的工作要尝试。特别是对用户体验工程师和产品，需要有更高的抽象概念及领域边界识别能力要求</li>
<li>关于项目管理。我认为这可能是影响微服务是否能产生最高价值的关键。从产品出发的每次迭代，往往涉及多个业务领域，而一个微服务团队往往无法专注于单一的产品迭代，因为需求可能来自不同的客户端、渠道、平台等。微服务团队与产品迭代之间的资源冲突是否能高效解决，不单单是微服务团队、产品、PO某一单一角色甚至团队决定的。而这个复杂的组织关系又往往是大型企业和项目需要面对、解决的问题。其中一个办法就是投入更多的人去做协调、对齐等知识传达工作。那么是否有一种方法能解决这个痛点，目前看来是需要一个能给微服务项目管理和产品管理之间找到平衡点的工具或方法。并且这个工具和方法在我看来很难像XP、Scrum、甚至大规模敏捷那样普遍适用，而更多的是需要对团队协作有资深经验的人员在对企业有足够深入的了解之后才能给出对应方案。</li>
</ul>
<blockquote>
<p>…main issue we have seen here, is that they tend to be organised around too many contexts</p>
</blockquote>
<p>第三段文字中有这样一句话，这个是针对微服务及团队应该划分到多小，文中也提到不应该让一个微服务由太多的上下文组织而成。</p>
<p>这种担心原因很明显，防止过多本不相干的上下文缠绕在一起，模糊了边界。</p>
<p>但这里我想说的是在团队有了一定服务化、业务领域识别的的基础上，可以不用强制团队或者服务按照边界一比一划分。</p>
<p>在原文中一个6人团队管理6个微服务的例子中，就是团队与服务1：N的关系。这种情况有利于团队文化、能力的构建与传播。</p>
<p>另外，真的一定要把边界清晰的不同上下文拆分成不同服务吗？我认为不是必须。只要我们可以保证不同上下文之间没有非必须的交互、控制好边界，也可以通过目录、代码包、module等形式来帮助边界的清晰。只要团队对于清晰边界的识别能力在、并且恪守了必要原则，那么在需要的时候、借助系列第一章中“Explicit Published Interface”相关方法拆分成单独服务其实是手到擒来的事情，毕竟进程间通信和进程内通信的成本有显著差异</p>
<p>《Microservices》原文：<br><a target="_blank" rel="noopener" href="https://martinfowler.com/articles/microservices.html">https://martinfowler.com/articles/microservices.html</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.xinyuanguo.com/2021/06/01/ms1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="xinyuan">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xinyuan's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Xinyuan's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/06/01/ms1/" class="post-title-link" itemprop="url">回顾《Microservices》系列之一：服务组件化</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-06-01 13:45:00" itemprop="dateCreated datePublished" datetime="2021-06-01T13:45:00+08:00">2021-06-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-09-07 15:30:10" itemprop="dateModified" datetime="2022-09-07T15:30:10+08:00">2022-09-07</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h4 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h4><p>每隔一段时间回头看Martin老师的<a target="_blank" rel="noopener" href="https://martinfowler.com/articles/microservices.html">microservices</a>,都多少有一些感悟和收获。因此准备分章节记录备忘，本章节对应原文的”Componentization via Services“</p>
<h2 id="定义与价值"><a href="#定义与价值" class="headerlink" title="定义与价值"></a>定义与价值</h2><p><strong>组件（Component）是一个可以被单独替换或升级的软件单元</strong></p>
<p><strong>组件化的首要手段是把软件拆分成服务</strong></p>
<p><strong>把服务作为组件使用的一个重要目的是服务可以独立部署</strong></p>
<h2 id="内聚与演进机制"><a href="#内聚与演进机制" class="headerlink" title="内聚与演进机制"></a>内聚与演进机制</h2><p>进程内的调用关系的变更需要重新部署本应用，而进程间接口的变更意味着：</p>
<ul>
<li>契约的更新</li>
<li>接口消费方的感知与通知，以及可能带来的人工沟通成本</li>
<li>调用双方的重新部署</li>
<li>向前兼容问题</li>
</ul>
<p>在产品持续迭代中我们很难避免这种情况，而我们能做的是：</p>
<ul>
<li>做好设计，让服务更加内聚、边界清晰，控制进程间调用数量</li>
<li>完善演进机制：调用关系纳入架构治理，明确影响范围；做好变更计划与淘汰计划，控制向前兼容逻辑膨胀</li>
</ul>
<p>向前兼容引起的逻辑膨胀在无限度的对客户端版本支持的情况下非常常见（如传统APP），我们首先要做的是在维护成本变得不可接受前，把支持的客户端版本限定在一个企业可承受的范围内</p>
<h2 id="“Explicit-Published-Interface”"><a href="#“Explicit-Published-Interface”" class="headerlink" title="“Explicit Published Interface”"></a>“Explicit Published Interface”</h2><p>在不同号称微服务的项目中，我们不难看到那些拼装HTTP请求，然后做个工具类来调用</p>
<p>这种模式让服务间请求在代码逻辑上依赖该工具，并且工具类调用充斥在业务代码中，更换工具成本高</p>
<p>相比通过传统文档来控制契约不被破坏、降低耦合，一个暴露细节的、可发布的接口机制，可以帮助组件化调用更加简单</p>
<p>一个典型的实践模式就是”智能终端共享接口+哑管道集成实现“，即：</p>
<ul>
<li>调用方和服务方共享一个接口（Interface），通过注解等元数据补充接口细节（比如校验规则、描述信息、实现协议等）。这样可以隐藏集成实现的选型和细节，让开发人员和代码逻辑不再关注对应的通信工具类</li>
<li>通信实现协议是HTTP、AMQP等粗粒度(coarser-grained)协议，保证对不同技术栈的支持</li>
<li>这个粗粒度协议应该是轻量的，再</li>
</ul>
<p>这种模式的优势有：</p>
<ul>
<li>由依赖注入解耦通信的实现细节，同时保证调用和实现的接口细节统一</li>
<li>可以通过CI工具，准实时更新接口规格，帮助接口文档的更新脱离手工劳作、更加高效和准确</li>
<li>开发人员直接面对接口，完全屏蔽RestTemplate、HTTPClient等工具的使用</li>
<li>通过分析工具，可以更便捷统计调用及依赖关系</li>
<li>更方便测试与Mock</li>
</ul>
<p>该模式最明显的问题是增加了调用双方的耦合，但是请注意：服务集成本身就是一种契约的实现，而<strong>契约本身就意味着耦合，这个耦合的价值是保证双方对契约的遵守</strong>。接口本身只是让契约更加高效的限制调用双方不破坏封装，并且让变更更容易感知</p>
<p>在多技术栈团队中，调用方无法直接使用这个共享接口。但自动化工具结合统一接口描述规范（类似<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/OpenAPI_Specification">OAS</a>）可以帮助我们，这种模式：</p>
<ul>
<li>使用工具根据代码生成接口描述文档</li>
<li>接口描述文档通过工具可生成不同技术栈的调用方代码</li>
</ul>
<p>但也有需要解决的问题：</p>
<ul>
<li>生成的代码可能需要二次调整才能符合团队代码规范</li>
<li>正向及逆向的”文档-代码“生成关系不同技术栈支持情况不一，特别是冷门技术栈</li>
</ul>
<p><strong>技术栈多元化与标准化根据企业及团队文化而异，这对管理者来说是个不可避免的权衡与取舍。</strong></p>
<p><strong>而这个技术文化对于服务组件化，粗粒度通信协议的统一、以及接口契约的高效集成等原则上带来的价值，是其在微服务实践中是否应该被采纳的衡量标准</strong></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.xinyuanguo.com/2020/11/06/mqasync/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="xinyuan">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xinyuan's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Xinyuan's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/11/06/mqasync/" class="post-title-link" itemprop="url">使用消息队列扩展异步执行的实现方式</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-11-06 17:52:00" itemprop="dateCreated datePublished" datetime="2020-11-06T17:52:00+08:00">2020-11-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-09-07 16:25:04" itemprop="dateModified" datetime="2022-09-07T16:25:04+08:00">2022-09-07</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>你可能在你的项目中用过Spring的@Async注解，以此来将部分方法转化为异步执行，从而提高请求的响应效率</p>
<p>但在服务架构不断的演进之中，这种丢入线程池处理的方式带来的缺陷也愈发明显：</p>
<ul>
<li>不利于监控</li>
<li>如果意外停机，尚未处理的任务会尽数丢失</li>
<li>在集群中的某个节点要处理大量异步任务时，无法将压力分担到集群中其他节点</li>
<li>项目中若集成了使用ThreadLocal特性的模块或第三方组件，需要注意上下文丢失的问题</li>
</ul>
<h1 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h1><p>使用消息队列作为异步任务的实现方式，这样我们就可以：</p>
<ul>
<li>大量成熟的MQ中间件都提供了可视化管理平台，监控更加方便</li>
<li>可以用消息队列Header来保存上下文，如用户信息、token等</li>
<li>消息队列的发布-订阅模式可以最大程度利用集群的业务处理能力</li>
<li>更容易保证任务的顺序性</li>
<li>如果有服务节点宕机，可以利用消息确认、消息重试等机制保证任务执行的正确性</li>
</ul>
<h1 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h1><p>为了保证业务代码和实现方案解耦，类似于@Aync方案，我们同样采用注解+拦截器的方式进行逻辑注入</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Around(&quot;@annotation(org.springframework.amqp.rabbit.annotation.RabbitListener)&quot;)</span></span><br><span class="line">	<span class="keyword">public</span> Object <span class="title function_">cut</span><span class="params">(ProceedingJoinPoint pjp)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">		...</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p>实现思路大同小异，就是读取注解中的队列声明确认发布-订阅关系，然后以丢入消息队列来替换丢入线程池 </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">private</span> String <span class="title function_">resolveKey</span><span class="params">(Queue[] queues)</span> &#123;</span><br><span class="line">	<span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="built_in">this</span>.beanFactory.resolveEmbeddedValue(queues[<span class="number">0</span>].value());</span><br><span class="line">	<span class="keyword">return</span> (String) resolver.evaluate(s, evalContext);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rabbitTemplate.convertAndSend(resolveKey(queues), args[<span class="number">0</span>]);</span><br></pre></td></tr></table></figure>

<p>为消息队列注入Json转换器，方便对象传输</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> Jackson2JsonMessageConverter <span class="title function_">producerJackson2MessageConverter</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Jackson2JsonMessageConverter</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如有需要，我们可以将上下文的用户信息、token等写入消息的Header中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">private</span> MessagePostProcessor <span class="title function_">beforePublishPostProcessor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> message -&gt; &#123;</span><br><span class="line"><span class="comment">//          setting up context to message header</span></span><br><span class="line">            <span class="keyword">return</span> message;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>被异步调用的service代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DemoService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@RabbitListener(queuesToDeclare = @Queue(&quot;mytestqueue&quot;))</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">checkSome</span><span class="params">(List&lt;String&gt; tagTuple)</span> &#123;</span><br><span class="line">        log.warn(<span class="string">&quot;check here &#123;&#125;&quot;</span>, tagTuple);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>调用service的controller：</p>
<p>@RestController <strong>public class</strong> DemoController {</p>
<pre><code>@Autowired
</code></pre>
<p>  <strong>private</strong> DemoService <strong>demoService</strong>;</p>
<pre><code>@RequestMapping(**&quot;check&quot;**)
**public** Integer checkSome() &#123;
    ArrayList&lt;String&gt; tagTuple = **new** ArrayList&lt;&gt;();
    tagTuple.add(**&quot;bar&quot;**);
    tagTuple.add(**&quot;foo&quot;**);
    **demoService**.checkSome(tagTuple);
    **return** 0;
&#125;
</code></pre>
<p>}</p>
<p>执行查看效果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">17:00:14.584TRACE[AbstractHandlerMapping.java:411]Mapped to org.smop.duplex.sample.DemoController#checkSome()</span><br><span class="line">17:00:21.263WARN [DemoService.java:16]check here [bar, foo]</span><br></pre></td></tr></table></figure>

<p>如有帮助或启发，还请点个👍</p>
<p>附代码仓库：</p>
<p><a target="_blank" rel="noopener" href="https://github.com/s-mop/homer">https://github.com/s-mop/homer</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>





</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">xinyuan</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  





  





</body>
</html>
